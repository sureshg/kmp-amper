repositories:
  - id: mavenLocal
    url: mavenLocal
    resolve: false
    publish: true
# - id: mavenCentral
#   url: https://cache-redirector.jetbrains.com/repo.maven.apache.org/maven2
# - id: gradle
#   url: https://cache-redirector.jetbrains.com/plugins.gradle.org/m2

settings:
  publishing:
    enabled: true
    group: dev.suresh.amper
    version: 1.0.0-SNAPSHOT

  jvm:
    release: 25
    storeParameterNames: true
    jdk:
      version: 25
      distributions: [ oracleOpenJdk, zulu ]
      # selectionMode: javaHome
    test:
      junitPlatformVersion: 6.1.0-M1
      freeJvmArgs:
        - --add-modules=jdk.incubator.vector
    #   - --enable-preview
    # systemProperties:
    # extraEnvironment

  kotlin:
    version: 2.3.20-RC
    languageVersion: 2.3
    apiVersion: 2.3
    progressiveMode: true
    allWarningsAsErrors: false
    suppressWarnings: false
    verbose: false
    freeCompilerArgs:
      - -Wextra
      - -Xcontext-parameters
      - -Xexpect-actual-classes
      - -Xreport-all-warnings
      - -Xreturn-value-checker=full
      - -Xcontext-sensitive-resolution
      - -Xannotation-default-target=param-property
      - -Xexplicit-backing-fields
      - -Xconsistent-data-class-copy-visibility
    # - -Xannotation-target-all
    # - -Xskip-prerelease-check
    # - -Xsuppress-warning=CAN_BE_VAL
    compilerPlugins:
      - id: com.javiersc.kotlin.kopy-compiler
        dependency: $libs.kopy.compilerPlugin

      # - id: io.exoquery.exoquery-plugin
      #   dependency: $libs.exoquery.compilerPlugin

      - id: dev.zacsweers.redacted.compiler
        dependency: $libs.kotlin.redacted.compilerPlugin
        options:
          enabled: true
          replacementString: "â–ˆ"
          redactedAnnotations: dev/zacsweers/redacted/annotations/Redacted
          unredactedAnnotations: dev/zacsweers/redacted/annotations/Unredacted

    optIns:
      - kotlin.ExperimentalStdlibApi
      - kotlin.ExperimentalUnsignedTypes
      - kotlin.contracts.ExperimentalContracts
      - kotlin.contracts.ExperimentalExtendedContracts
      - kotlin.io.encoding.ExperimentalEncodingApi
      - kotlin.time.ExperimentalTime
      - kotlinx.coroutines.ExperimentalCoroutinesApi
      - kotlinx.serialization.ExperimentalSerializationApi
      - kotlin.ExperimentalMultiplatform
      - kotlin.uuid.ExperimentalUuidApi
      - kotlin.concurrent.atomics.ExperimentalAtomicApi
      - com.javiersc.kotlin.kopy.KopyOptIn

    serialization:
      version: 1.10.0
      format: json

    ksp:
      version: 2.3.6
      processors:
        - $libs.kotlinx.schema.ksp

    rpc:
      enabled: true
      version: 0.10.2
      annotationTypeSafetyEnabled: true

settings@jvm:
  java:
    compileIncrementally: true
    freeCompilerArgs:
      - -Xlint:all
      - --add-modules=jdk.incubator.vector
    # - --enable-preview
    # annotationProcessing:
    #   processors:
    #     - $libs.google.auto.service
    #   processorOptions:
    #     - debug: "true"

  kotlin:
    freeCompilerArgs:
      - -Xno-param-assertions
      - -Xno-call-assertions
      - -Xno-receiver-assertions
      - -Xwhen-expressions=indy
      # - -Xjvm-enable-preview
      # - -Xjvm-expose-boxed
      # - -Xjdk-release=25
      # - -Xadd-modules=ALL-MODULE-PATH
      # - -Xmodule-path=
      # - -Xjavac-arguments="--add-exports java.base/sun.nio.ch=ALL-UNNAMED"
      # - -Xexplicit-api=strict

    ksp:
      processors:
        - $libs.ksp.auto.service

  junit: junit-5

settings@native:
  kotlin:
    debug: false
    optIns:
      - kotlinx.cinterop.ExperimentalForeignApi
      - kotlin.experimental.ExperimentalNativeApi

settings@linux:
  kotlin:
    linkerOptions: [
      "-Wl,--as-needed",
      "-Wl,-Bstatic",
      "-lz",
      "-Wl,-Bdynamic"
    ]

settings@web:
  kotlin:
    freeCompilerArgs:
      - -target=es2015
      - -source-map
      - -Xir-dce=true
      - -Xgenerate-dts
      - -Xes-long-as-bigint
      - -Xir-per-file
      - -Xwasm-use-new-exception-proposal
      - -Xenable-suspend-function-exporting
    # - -Xir-per-module
    optIns:
      - kotlin.js.ExperimentalJsExport
      - kotlin.js.ExperimentalWasmJsInterop

    jsPlainObjects: enabled

test-settings:
  kotlin:
    powerAssert:
      enabled: true
      functions:
        - kotlin.assert
        - kotlin.require
        - kotlin.test.assertTrue
        - kotlin.test.assertEquals
        - kotlin.test.assertNull

